<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>etch-a-sketch</title>
    <link href="styles/style.css" rel="stylesheet">
  </head>
  <body>

    <div id="menu">
      <button id="pen" onclick="toggleTool(pen)">Pen</button>
      <button id="color" onclick="toggleTool(color)">Color</button>
      <button id ="darken" onclick="toggleTool(darken)">Darken</button>
      <button id="erase" onclick="toggleTool(erase)">Erase</button>
      <button id="clearButton" onclick="clearBoard()">Clear</button>
      <button id="newGrid" onclick="newGrid()">New Grid</button>

    </div>

    <div id="container">

    </div>

    
    <script>

      let squares;
      let resolution;
      let container = document.querySelector('#container');

      function createBoard(resolution) {
        let div;
        let fragment = document.createDocumentFragment();

        for (let i=0; i<resolution; i++){
          for (let j=0; j<resolution; j++) {
            div = document.createElement('div');
            fragment.appendChild(div);
          }
        }
        container.appendChild(fragment);

        let boardStyle = window.getComputedStyle(container);

        let rowNum = parseInt(boardStyle.getPropertyValue("--rowNum"));
        document.documentElement.style.setProperty("--rowNum", resolution);

        let colNum = parseInt(boardStyle.getPropertyValue("--colNum"));
        document.documentElement.style.setProperty("--colNum", resolution);
        
        toggleTool(pen);

      };

      window.onload = createBoard(16);
      
      function toggleTool(tool) {
        squares = container.querySelectorAll('div');
        squareClass = squares.forEach(div => div.setAttribute("class", "squareColor"));

        squares.forEach(div => div.removeEventListener('mouseover', pen));
        squares.forEach(div => div.removeEventListener('mouseover', erase));
        squares.forEach(div => div.removeEventListener('mouseover', color));
        squares.forEach(div => div.removeEventListener('mouseover', darken));
        
        squares.forEach(div => div.addEventListener('mouseover', tool));
      }

      
      function pen(e) {
        e.target.style.backgroundColor = "hsl(34, 57%, 70%)";
      }

      function erase(e) {
        e.target.style.backgroundColor = '';

      }



      function color(e) {
        e.target.style.backgroundColor = randomColor();

        function randomColor() {
          return 'hsl(' + random(0,50) + ', ' + random(10,30) + '%, ' + random(60,80) +  '%)';
        }
        function random(min,max) {
          let num = Math.floor(Math.random()*(max-min)) + min;
          return num;
        }

      }

      function darken(e) {
          let currentB = getComputedStyle(e.target).getPropertyValue("--brightness");
          let reduceB = currentB * 0.9;
          e.target.style.setProperty("--brightness", reduceB);
        
      }
      
      

      function clearBoard() {
        squares.forEach(div => div.style.backgroundColor = '');
      }

      function newGrid() {
        resolution = prompt("Please enter grid resolution", "16");
          if (isNaN(resolution) || resolution == null) {
            return;
          }
          else if (resolution<1 || resolution>200){
            resolution = prompt("Please enter grid resolution between 1 and 100", "50");
          }
          createBoard(resolution);
      }

       

    </script>
  </body>
</html>

